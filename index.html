<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloud Mart - Admin</title>
<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:0;
}
header {
  background:#333;
  color:#fff;
  padding:15px;
  text-align:center;
  font-size:22px;
}
.container {
  padding:20px;
}
h2 {
  margin-top:30px;
}
input, select, button {
  padding:8px;
  margin:5px 0;
  border:1px solid #ccc;
  border-radius:5px;
}
table {
  width:100%;
  border-collapse:collapse;
  border-spacing:0;
  margin-top:15px;
}
th, td {
  border:1px solid #ddd;
  padding:12px 10px;
  text-align:center;
  vertical-align: middle;
}
th {
  background:#555;
  color:#fff;
  font-weight:600;
}
button {
  cursor:pointer;
  transition:0.3s;
}
button:hover {
  transform:scale(1.05);
}
.delete {
  background:#dc3545;
  color:#fff;
  border:none;
  padding:5px 10px;
}
.done {
  background:#28a745;
  color:#fff;
  border:none;
  padding:5px 10px;
}
.print {
  background:#007bff;
  color:#fff;
  border:none;
  padding:5px 10px;
}
tbody tr {
  opacity:0;
  transform:translateY(10px);
  transition:0.4s ease;
}
tbody tr.show {
  opacity:1;
  transform:translateY(0);
}
</style>
</head>
<body>
<header>Cloud Mart - Admin Panel</header>
<div class="container">

<h2>Payment Method</h2>
<label>Bkash Number:</label>
<input type="text" id="adminBkash" placeholder="Enter Bkash Number">
<button onclick="saveBkash()">Save</button><br>
<label>Nagad Number:</label>
<input type="text" id="adminNagad" placeholder="Enter Nagad Number">
<button onclick="saveNagad()">Save</button>

<!-- Add Product -->
<h2>Add Product</h2>
<form id="productForm">
<input type="text" id="prodName" placeholder="Product Name" required>
<input type="text" id="prodCategory" placeholder="Category" required>
<input type="number" id="prodPrice" placeholder="Price" step="0.01" required>
<input id="prodDescription" placeholder="Product Description" required>
<input type="file" id="prodImage" accept="image/*">
<button type="submit">Add Product</button>
</form>

<h2>Product List</h2>
<table>
<thead>
  <tr>
    <th>Name</th>
    <th>Category</th>
    <th>Price</th>
    <th>Description</th>
    <th>Image</th>
    <th>Action</th>
  </tr>
</thead>
<tbody id="productList"></tbody>
</table>

<h2>Orders</h2>
<table>
<thead>
  <tr>
    <th>Product</th>
    <th>User</th>
    <th>Email</th>
    <th>Phone</th>
    <th>Payment</th>
    <th>Send Number</th>
    <th>Trnx ID</th>
    <th>Date</th>
    <th>Actions</th>
  </tr>
</thead>
<tbody id="orderList"></tbody>
</table>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCl9ENd3XOP1KeutD7s1zSiXYSuz4VIqGU",
  authDomain: "cloud-mart01.firebaseapp.com",
  databaseURL: "https://cloud-mart01-default-rtdb.firebaseio.com",
  projectId: "cloud-mart01",
  storageBucket: "cloud-mart01.firebasestorage.app",
  messagingSenderId: "656495467691",
  appId: "1:656495467691:web:b0c0f7356b36af5de12bee",
  measurementId: "G-PXLYR809MM"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Payment Save
function saveBkash(){
  const bkash = document.getElementById("adminBkash").value;
  firebase.database().ref("payment").update({ bkash: bkash });
  alert("Bkash Number saved!");
}
function saveNagad(){
  const nagad = document.getElementById("adminNagad").value;
  firebase.database().ref("payment").update({ nagad: nagad });
  alert("Nagad Number saved!");
}

// Load saved payment
firebase.database().ref("payment").on("value",snap=>{
  const data = snap.val();
  if(data){
    document.getElementById("adminBkash").value = data.bkash || "";
    document.getElementById("adminNagad").value = data.nagad || "";
  }
});

// Product Add
document.getElementById("productForm").addEventListener("submit", e=>{
  e.preventDefault();
  const file=document.getElementById("prodImage").files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=function(ev){
      addProduct(ev.target.result);
    }
    reader.readAsDataURL(file);
  } else {
    addProduct("");
  }
});

function addProduct(imgData){
  const newP={
    name:document.getElementById("prodName").value,
    category:document.getElementById("prodCategory").value,
    price:document.getElementById("prodPrice").value,
    description:document.getElementById("prodDescription").value,
    image:imgData
  };
  firebase.database().ref("products").push(newP);
  document.getElementById("productForm").reset();
}

// Render Products
const productList=document.getElementById("productList");
firebase.database().ref("products").on("value",snapshot=>{
  productList.innerHTML="";
  snapshot.forEach(child=>{
    const p = child.val();
    const key = child.key;
    let tr=document.createElement("tr");
    tr.className="show";
    tr.innerHTML=`
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>$${p.price}</td>
      <td>${p.description}</td>
      <td>${p.image?'<img src="'+p.image+'" width="50">':''}</td>
      <td><button class="delete" onclick="deleteProduct('${key}')">Delete</button></td>`;
    productList.appendChild(tr);
  });
});

function deleteProduct(id){
  firebase.database().ref("products/"+id).remove();
}

// Render Orders
const orderList=document.getElementById("orderList");
firebase.database().ref("orders").on("value",snapshot=>{
  orderList.innerHTML="";
  snapshot.forEach(child=>{
    const o=child.val();
    const key=child.key;
    let tr=document.createElement("tr");
    tr.className="show";
    tr.innerHTML=`
      <td>${o.product}</td>
      <td>${o.name}</td>
      <td>${o.email}</td>
      <td>${o.phone}</td>
      <td>${o.payment}</td>
      <td>${o.sendNumber||''}</td>
      <td>${o.trnx||''}</td>
      <td>${o.date}</td>
      <td>
        <button class="done" onclick="deleteOrder('${key}')">Done</button>
        <button class="print" onclick="printInvoice('${key}')">Print</button>
      </td>`;
    orderList.appendChild(tr);
  });
});

function deleteOrder(id){
  firebase.database().ref("orders/"+id).remove();
}

// Print Invoice
function printInvoice(id){
  firebase.database().ref("orders/"+id).once("value").then(snap=>{
    const o = snap.val();
    let w = window.open('', '', 'width=800,height=600');
    w.document.write(`
      <html>
      <head><title>Admin Invoice</title></head>
      <body>
        <h2>Cloud Mart Invoice</h2>
        <p><b>Date:</b> ${o.date}</p>
        <p><b>Name:</b> ${o.name}</p>
        <p><b>Email:</b> ${o.email}</p>
        <p><b>Phone:</b> ${o.phone}</p>
        <p><b>Product:</b> ${o.product}</p>
        <p><b>Payment:</b> ${o.payment}</p>
        <p><b>Send Number:</b> ${o.sendNumber||''}</p>
        <p><b>Transaction ID:</b> ${o.trnx||''}</p>
        <hr>
        <p>âœ… Thank you for your purchase!</p>
      </body>
      </html>
    `);
    w.document.close();
    w.print();
  });
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Cloud Mart - Admin (Firebase)</title>
<style>
/* আগের style অপরিবর্তিত রাখা হলো */
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
header { background:#333; color:#fff; padding:15px; text-align:center; font-size:22px; }
.container { padding:20px; }
h2 { margin-top:30px; }
input, select, button, textarea { padding:8px; margin:5px 0; border:1px solid #ccc; border-radius:5px; width:100%; box-sizing:border-box; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { border:1px solid #ddd; padding:12px 10px; text-align:center; }
th { background:#555; color:#fff; }
button { cursor:pointer; transition:0.3s; }
button:hover { transform:scale(1.05); }
.delete { background:#dc3545; color:#fff; border:none; padding:5px 10px; }
.done { background:#28a745; color:#fff; border:none; padding:5px 10px; }
.print { background:#007bff; color:#fff; border:none; padding:5px 10px; }
.edit { background:#ffc107; color:#111; border:none; padding:5px 10px; }
img.thumb { width:50px; height:50px; object-fit:cover; border-radius:6px; }
</style>
</head>
<body>
<header>Cloud Mart - Admin Panel (Firebase)</header>
<div class="container">

  <h2>Add / Edit Product</h2>
  <form id="productForm">
    <input type="text" id="prodName" placeholder="Product Name" required>
    <input type="text" id="prodCategory" placeholder="Category" required>
    <input type="number" id="prodPrice" placeholder="Price" step="0.01" required>
    <input type="text" id="prodDescription" placeholder="Product Description" required>
    <input type="file" id="prodImage" accept="image/*">
    <button type="submit" id="addUpdateBtn">Add Product</button>
  </form>

  <h2>Product List</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Category</th><th>Price</th><th>Description</th><th>Image</th></tr>
    </thead>
    <tbody id="productList"></tbody>
  </table>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCl9ENd3XOP1KeutD7s1zSiXYSuz4VIqGU",
  authDomain: "cloud-mart01.firebaseapp.com",
  databaseURL: "https://cloud-mart01-default-rtdb.firebaseio.com",
  projectId: "cloud-mart01",
  storageBucket: "cloud-mart01.appspot.com",   // এখানে storageBucket ঠিক করা হলো
  messagingSenderId: "656495467691",
  appId: "1:656495467691:web:b0c0f7356b36af5de12bee"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

const prodForm = document.getElementById('productForm');
const prodList = document.getElementById('productList');
const prodName = document.getElementById('prodName');
const prodCategory = document.getElementById('prodCategory');
const prodPrice = document.getElementById('prodPrice');
const prodDescription = document.getElementById('prodDescription');
const prodImage = document.getElementById('prodImage');

prodForm.addEventListener('submit', e=>{
  e.preventDefault();
  const name = prodName.value.trim();
  const category = prodCategory.value.trim();
  const price = prodPrice.value.trim();
  const description = prodDescription.value.trim();
  const file = prodImage.files[0];

  if(!name || !category || !price){ alert("সব ফিল্ড পূরণ করুন"); return; }

  if(file){
    const storageRef = storage.ref('products/' + Date.now() + '_' + file.name);
    storageRef.put(file).then(snapshot=>{
      snapshot.ref.getDownloadURL().then(url=>{
        saveProduct({name, category, price, description, image:url});
      });
    }).catch(err=>alert("Image upload failed: " + err));
  } else {
    saveProduct({name, category, price, description, image:""});
  }
});

function saveProduct(obj){
  db.ref('products').push(obj).then(()=>{
    alert("Product Added Successfully");
    prodForm.reset();
  }).catch(e=>alert("Failed: "+e));
}

db.ref('products').on('value', snap=>{
  prodList.innerHTML = "";
  snap.forEach(child=>{
    const p = child.val();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>${p.price}</td>
      <td>${p.description}</td>
      <td>${p.image? `<img class="thumb" src="${p.image}">` : 'No Image'}</td>
    `;
    prodList.appendChild(tr);
  });
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloud Mart - User</title>
<style>
body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0;}
header { background:#fff; padding:15px; text-align:center; font-size:22px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.1); position:relative;}
header .logo { height:40px; width:auto; border-radius:8px;}
.container { padding:20px;}
.search-bar { margin-bottom:20px; display:flex; gap:10px; align-items:center;}
input, select, button { padding:10px; margin:5px 0; border:1px solid #ccc; border-radius:5px;}
.product-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:20px;}
.card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; opacity:0; transform:translateY(20px); transition:0.5s;}
.card.show { opacity:1; transform:translateY(0);}
.card img { width:100%; height:140px; object-fit:cover; border-radius:8px; transition:0.3s;}
.card:hover img { transform:scale(1.05);}
.card button { background:#007bff; color:#fff; border:none; padding:10px; width:100%; border-radius:5px; cursor:pointer; transition:0.3s;}
.card button:hover { background:#0056b3;}
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; opacity:0; transition:0.3s; z-index:999;}
.modal.show { display:flex; opacity:1;}
.modal-content { background:#fff; padding:20px; border-radius:10px; width:320px; animation:fadeIn 0.5s;}
@keyframes fadeIn { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
.close { cursor:pointer; font-weight:bold; float:right;}
#bkashFields, #nagadFields { display:none; }

/* ===== Order Status Panel ===== */
#orderStatusPanel {
  position:fixed; top:0; right:-400px; width:350px; height:100%;
  background:#fff; box-shadow:-2px 0 10px rgba(0,0,0,0.2);
  transition:0.4s; padding:0; overflow-y:auto; z-index:1000;
  display:flex; flex-direction:column;
}
#orderStatusPanel.show { right:0; }
#orderStatusBtn {
  margin-left:auto; padding:8px 15px;
  background:#2a99f4; color:#fff; border:none; border-radius:6px;
  cursor:pointer; font-size:14px;
  transition:0.3s;
}
#orderStatusBtn:hover { background:#298cdc; }

/* Panel Header */
#orderPanelHeader {
  background:#007bff; color:#fff; padding:15px; font-size:18px;
  display:flex; justify-content:space-between; align-items:center;
  border-top-left-radius:6px; border-top-right-radius:6px;
}
#orderPanelHeader .closePanel { cursor:pointer; font-size:18px; font-weight:bold; }

/* Orders Table */
.completed { padding:10px; }
.completed table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.completed th, .completed td { border:1px solid #ddd; padding:8px; text-align:center; font-size:13px;}
.completed th { background:#007bff; color:#fff;}
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="Cloud Mart logo" class="logo">
  <span>Cloud Mart</span>
</header>

<div class="container">
  <div class="search-bar">
    <input type="text" id="search" placeholder="Search product...">
    <select id="categoryFilter"></select>
    <button id="orderStatusBtn">ðŸ“¦ Order Status</button>
  </div>
  
  <div class="product-grid" id="productGrid"></div>
</div>

<div id="orderStatusPanel">
  <div id="orderPanelHeader">
    <span>âœ… Your Orders</span>
    <span class="closePanel" id="closeOrderPanel">&times;</span>
  </div>
  <div class="completed">
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Payment</th>
          <th>Trnx ID</th>
          <th>Date</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="completedList"></tbody>
    </table>
  </div>
</div>

<div class="modal" id="orderModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>Order Product</h3>
    <form id="orderForm">
      <input type="text" id="orderProduct" readonly><br>
      <input id="orderDescription" readonly><br>
      <input type="text" id="userName" placeholder="Your Name" required><br>
      <input type="email" id="userEmail" placeholder="Email" required><br>
      <input type="tel" id="userPhone" placeholder="Phone Number" required><br>
      <select id="paymentMethod" required>
        <option value="">Select Payment</option>
        <option value="Bkash">Bkash</option>
        <option value="Nagad">Nagad</option>
      </select><br>
      <div id="bkashFields">
        <p>Bkash Number: <span id="adminBkashNum"></span></p>
        <input type="text" id="sendNumberBkash" placeholder="Your Send Money Number"><br>
        <input type="text" id="trnxIDBkash" placeholder="Transaction ID"><br>
      </div>
      <div id="nagadFields">
        <p>Nagad Number: <span id="adminNagadNum"></span></p>
        <input type="text" id="sendNumberNagad" placeholder="Your Send Money Number"><br>
        <input type="text" id="trnxIDNagad" placeholder="Transaction ID"><br>
      </div>
      <button type="submit">Submit Order</button>
      <button type="button" onclick="closeModal()">Cancel</button>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyD-UpdatedAPIKeyExample123456",
  authDomain: "cloud-mart01.firebaseapp.com",
  databaseURL: "https://cloud-mart01-default-rtdb.firebaseio.com",
  projectId: "cloud-mart01",
  storageBucket: "cloud-mart01.appspot.com",
  messagingSenderId: "656495467691",
  appId: "1:656495467691:web:updatedappid123456",
  measurementId: "G-UPDATEDMEASUREID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const productGrid=document.getElementById("productGrid");
const search=document.getElementById("search");
const categoryFilter=document.getElementById("categoryFilter");
const orderModal=document.getElementById("orderModal");
const orderProduct=document.getElementById("orderProduct");
const orderDescription=document.getElementById("orderDescription");
const paymentMethod=document.getElementById("paymentMethod");
const bkashFields=document.getElementById("bkashFields");
const nagadFields=document.getElementById("nagadFields");
const adminBkashNum=document.getElementById("adminBkashNum");
const adminNagadNum=document.getElementById("adminNagadNum");
const completedList=document.getElementById("completedList");

/* ===== Load Products ===== */
let products=[];
onValue(ref(db,"products"),snapshot=>{
  products=[]; productGrid.innerHTML="";
  if(snapshot.exists()){
    snapshot.forEach(child=>products.push(child.val()));
  }
  renderCategories();
  renderProducts();
});

/* ===== Load Payment Numbers ===== */
onValue(ref(db,"payment"),snap=>{
  const d=snap.val()||{};
  adminBkashNum.textContent=d.bkash||"";
  adminNagadNum.textContent=d.nagad||"";
});

/* ===== Render Functions ===== */
function renderCategories(){
  let cats=[...new Set(products.map(p=>p.category))];
  categoryFilter.innerHTML=`<option value="">All Categories</option>`;
  cats.forEach(c=>categoryFilter.innerHTML+=`<option value="${c}">${c}</option>`);
}
function renderProducts(){
  let term=search.value.toLowerCase();
  let cat=categoryFilter.value;
  productGrid.innerHTML="";
  products.filter(p=>(!cat||p.category===cat)&&p.name.toLowerCase().includes(term))
    .forEach((p,i)=>{
      let card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <img src="${p.image||'https://via.placeholder.com/200'}">
        <h4>${p.name}</h4>
        <p>${p.category}</p>
        <p>${p.description}</p>
        <p><b>$${p.price}</b></p>
        <button onclick="openModal('${p.name}','${p.description.replace(/'/g,"&#39;")}')">Order</button>`;
      productGrid.appendChild(card);
      setTimeout(()=>card.classList.add("show"),100*i);
    });
}

/* ===== Modal Functions ===== */
window.openModal=function(name,desc){
  orderProduct.value=name;
  orderDescription.value=desc;
  orderModal.classList.add("show");
  bkashFields.style.display="none";
  nagadFields.style.display="none";
  paymentMethod.value="";
}
window.closeModal=function(){ orderModal.classList.remove("show"); }
paymentMethod.addEventListener("change",()=>{
  bkashFields.style.display=paymentMethod.value==="Bkash"?"block":"none";
  nagadFields.style.display=paymentMethod.value==="Nagad"?"block":"none";
});

/* ===== Order Submit ===== */
document.getElementById("orderForm").addEventListener("submit",e=>{
  e.preventDefault();
  const newOrder={
    product:orderProduct.value,
    description:orderDescription.value,
    name:document.getElementById("userName").value,
    email:document.getElementById("userEmail").value,
    phone:document.getElementById("userPhone").value,
    payment:paymentMethod.value,
    sendNumber:paymentMethod.value==="Bkash"?document.getElementById("sendNumberBkash").value:document.getElementById("sendNumberNagad").value,
    trnx:paymentMethod.value==="Bkash"?document.getElementById("trnxIDBkash").value:document.getElementById("trnxIDNagad").value,
    date:new Date().toLocaleString(),
    status:"Pending"
  };
  const orderRef=push(ref(db,"orders"));
  set(orderRef,newOrder).then(()=>{
    alert("Order Submitted!");
    e.target.reset();
    closeModal();
  });
});

/* ===== Show Orders with Status (max 5, live update) ===== */
onValue(ref(db,"orders"),snap=>{
  completedList.innerHTML="";
  if(snap.exists()){
    let arr=[];
    snap.forEach(child=> arr.push(child.val()));
    arr.sort((a,b)=> new Date(b.date) - new Date(a.date));
    arr.slice(0,5).forEach(o=>{
      let tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${o.product}</td>
        <td>${o.payment}</td>
        <td>${o.trnx}</td>
        <td>${o.date}</td>
        <td>${o.status}</td>`; // Pending / Order Complete
      completedList.appendChild(tr);
    });
  }
});

/* ===== Events ===== */
search.addEventListener("input",renderProducts);
categoryFilter.addEventListener("change",renderProducts);

/* ===== Order Status Panel Toggle ===== */
const orderPanel=document.getElementById("orderStatusPanel");
document.getElementById("orderStatusBtn").addEventListener("click",()=>{ orderPanel.classList.add("show"); });
document.getElementById("closeOrderPanel").addEventListener("click",()=>{ orderPanel.classList.remove("show"); });

</script>
</body>
</html>

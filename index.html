<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloud Mart - Admin</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
header { background:#333; color:#fff; padding:15px; text-align:center; font-size:22px; }
.container { padding:20px; }
h2 { margin-top:30px; }
input, select, button { padding:8px; margin:5px 0; border:1px solid #ccc; border-radius:5px; }
table { width:100%; border-collapse:collapse; border-spacing:0; margin-top:15px; }
th, td { border:1px solid #ddd; padding:12px 10px; text-align:center; vertical-align: middle; }
th { background:#555; color:#fff; font-weight:600; }
button { cursor:pointer; transition:0.3s; }
button:hover { transform:scale(1.05); }
.delete { background:#dc3545; color:#fff; border:none; padding:5px 10px; }
.done { background:#28a745; color:#fff; border:none; padding:5px 10px; }
.print { background:#007bff; color:#fff; border:none; padding:5px 10px; }
tbody tr { opacity:0; transform:translateY(10px); transition:0.4s ease; }
tbody tr.show { opacity:1; transform:translateY(0); }
</style>
</head>
<body>

<header>Cloud Mart - Admin Panel</header>
<div class="container">

<h2>Payment Method</h2>
<label>Bkash Number:</label>
<input type="text" id="adminBkash" placeholder="Enter Bkash Number">
<button onclick="saveBkash()">Save</button><br>
<label>Nagad Number:</label>
<input type="text" id="adminNagad" placeholder="Enter Nagad Number">
<button onclick="saveNagad()">Save</button>

<h2>Add Product</h2>
<form id="productForm">
<input type="text" id="prodName" placeholder="Product Name" required>
<input type="text" id="prodCategory" placeholder="Category" required>
<input type="number" id="prodPrice" placeholder="Price" step="0.01" required>
<input id="prodDescription" placeholder="Product Description" required>
<input type="file" id="prodImage" accept="image/*">
<button type="submit">Add Product</button>
</form>

<h2>Product List</h2>
<table>
<thead>
<tr>
<th>Name</th><th>Category</th><th>Price</th><th>Description</th><th>Image</th><th>Action</th>
</tr>
</thead>
<tbody id="productList"></tbody>
</table>

<h2>Orders</h2>
<table>
<thead>
<tr>
<th>Product</th><th>User</th><th>Email</th><th>Phone</th><th>Payment</th><th>Send Number</th><th>Trnx ID</th><th>Date</th><th>Actions</th>
</tr>
</thead>
<tbody id="orderList"></tbody>
</table>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCl9ENd3XOP1KeutD7s1zSiXYSuz4VIqGU",
  authDomain: "cloud-mart01.firebaseapp.com",
  databaseURL: "https://cloud-mart01-default-rtdb.firebaseio.com",
  projectId: "cloud-mart01",
  storageBucket: "cloud-mart01.appspot.com",
  messagingSenderId: "656495467691",
  appId: "1:656495467691:web:b0c0f7356b36af5de12bee",
  measurementId: "G-PXLYR809MM"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

const productList = document.getElementById("productList");
const orderList = document.getElementById("orderList");

// Load Payment Numbers
db.ref("payment").once("value").then(snap=>{
  const data = snap.val() || {};
  document.getElementById("adminBkash").value = data.bkash || "";
  document.getElementById("adminNagad").value = data.nagad || "";
});

function saveBkash(){
  const bkash = document.getElementById("adminBkash").value;
  db.ref("payment/bkash").set(bkash);
  alert("Bkash Number saved!");
}

function saveNagad(){
  const nagad = document.getElementById("adminNagad").value;
  db.ref("payment/nagad").set(nagad);
  alert("Nagad Number saved!");
}

// Render Products
function renderProducts(){
  productList.innerHTML="";
  db.ref("products").once("value").then(snap=>{
    const products = snap.val()||{};
    Object.keys(products).forEach((key,i)=>{
      const p = products[key];
      let tr = document.createElement("tr");
      tr.className="show";
      tr.innerHTML=`
        <td>${p.name}</td>
        <td>${p.category}</td>
        <td>$${p.price}</td>
        <td>${p.description}</td>
        <td>${p.image?'<img src="'+p.image+'" width="50">':''}</td>
        <td><button class="delete" onclick="deleteProduct('${key}')">Delete</button></td>`;
      productList.appendChild(tr);
      setTimeout(()=>tr.classList.add("show"),100*i);
    });
  });
}

// Render Orders
function renderOrders(){
  orderList.innerHTML="";
  db.ref("orders").once("value").then(snap=>{
    const orders = snap.val()||{};
    Object.keys(orders).forEach((key,i)=>{
      const o = orders[key];
      let tr = document.createElement("tr");
      tr.className="show";
      tr.innerHTML=`
        <td>${o.product}</td>
        <td>${o.name}</td>
        <td>${o.email}</td>
        <td>${o.phone}</td>
        <td>${o.payment}</td>
        <td>${o.sendNumber||''}</td>
        <td>${o.trnx||''}</td>
        <td>${o.date}</td>
        <td>
          <button class="done" onclick="deleteOrder('${key}')">Done</button>
          <button class="print" onclick="printInvoice('${key}')">Print</button>
        </td>`;
      orderList.appendChild(tr);
      setTimeout(()=>tr.classList.add("show"),100*i);
    });
  });
}

// Add Product
document.getElementById("productForm").addEventListener("submit", e=>{
  e.preventDefault();
  const file = document.getElementById("prodImage").files[0];
  if(file){
    const storageRef = storage.ref("products/"+Date.now()+"_"+file.name);
    storageRef.put(file).then(snapshot=>{
      snapshot.ref.getDownloadURL().then(url=>{
        addProduct(url);
      });
    });
  } else {
    addProduct("");
  }
});

function addProduct(imgURL){
  const newP = {
    name: document.getElementById("prodName").value,
    category: document.getElementById("prodCategory").value,
    price: document.getElementById("prodPrice").value,
    description: document.getElementById("prodDescription").value,
    image: imgURL
  };
  const newRef = db.ref("products").push();
  newRef.set(newP).then(()=>{
    document.getElementById("productForm").reset();
    renderProducts();
  });
}

function deleteProduct(key){
  db.ref("products/"+key).remove().then(renderProducts);
}

function deleteOrder(key){
  db.ref("orders/"+key).remove().then(renderOrders);
}

function printInvoice(key){
  db.ref("orders/"+key).once("value").then(snap=>{
    const o = snap.val();
    let w = window.open('', '', 'width=800,height=600');
    w.document.write(`
      <html>
      <head><title>Admin Invoice</title></head>
      <body>
        <h2>Cloud Mart Invoice</h2>
        <p><b>Date:</b> ${o.date}</p>
        <p><b>Name:</b> ${o.name}</p>
        <p><b>Email:</b> ${o.email}</p>
        <p><b>Phone:</b> ${o.phone}</p>
        <p><b>Product:</b> ${o.product}</p>
        <p><b>Payment:</b> ${o.payment}</p>
        <p><b>Send Number:</b> ${o.sendNumber}</p>
        <p><b>Transaction ID:</b> ${o.trnx}</p>
        <hr>
        <p>âœ… Thank you for your purchase!</p>
      </body>
      </html>
    `);
    w.document.close();
    w.print();
  });
}

renderProducts();
renderOrders();
</script>
</body>
</html>

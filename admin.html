<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloud Mart - Admin</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
header { background:#333; color:#fff; padding:15px; text-align:center; font-size:22px; }
.container { padding:20px; }
h2 { margin-top:30px; }
input, select, button, textarea { padding:8px; margin:5px 0; border:1px solid #ccc; border-radius:5px; width:100%; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { border:1px solid #ddd; padding:10px; text-align:center; }
th { background:#555; color:#fff; }
button { cursor:pointer; transition:0.3s; }
button:hover { transform:scale(1.05); }
.delete { background:#dc3545; color:#fff; border:none; padding:5px 10px; }
.done { background:#28a745; color:#fff; border:none; padding:5px 10px; }
.print { background:#007bff; color:#fff; border:none; padding:5px 10px; }
tr { opacity:0; transform:translateY(20px); transition:0.5s; }
tr.show { opacity:1; transform:translateY(0); }
</style>
</head>
<body>
<header>Cloud Mart - Admin Panel</header>
<div class="container">

<h2>Payment Settings</h2>
<label>Bkash Number:</label>
<input type="text" id="adminBkash" placeholder="Enter Bkash Number">
<button onclick="saveBkash()">Save</button><br>
<label>Nagad Number:</label>
<input type="text" id="adminNagad" placeholder="Enter Nagad Number">
<button onclick="saveNagad()">Save</button>

<h2>Add Product</h2>
<form id="productForm">
<input type="text" id="prodName" placeholder="Product Name" required>
<input type="text" id="prodCategory" placeholder="Category" required>
<input type="number" id="prodPrice" placeholder="Price" required>
<textarea id="prodDescription" placeholder="Product Description" required></textarea>
<input type="file" id="prodImage" accept="image/*">
<button type="submit">Add Product</button>
</form>

<h2>Product List</h2>
<table>
<thead><tr><th>Name</th><th>Category</th><th>Price</th><th>Description</th><th>Image</th><th>Action</th></tr></thead>
<tbody id="productList"></tbody>
</table>

<h2>Orders</h2>
<table>
<thead><tr><th>Product</th><th>User</th><th>Email</th><th>Phone</th><th>Payment</th><th>Send Number</th><th>Trnx ID</th><th>Date</th><th>Actions</th></tr></thead>
<tbody id="orderList"></tbody>
</table>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCjxG7JzLbElQ03bBMeVb-cOlvTBq6pn7o",
  authDomain: "cloudmart-40404.firebaseapp.com",
  databaseURL: "https://cloudmart-40404-default-rtdb.firebaseio.com",
  projectId: "cloudmart-40404",
  storageBucket: "cloudmart-40404.appspot.com",
  messagingSenderId: "1018112523638",
  appId: "1:1018112523638:web:ec5dd627a16aec707dce57",
  measurementId: "G-JD5F9TMYK6"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// DOM
const productList = document.getElementById("productList");
const orderList = document.getElementById("orderList");
const adminBkash = document.getElementById("adminBkash");
const adminNagad = document.getElementById("adminNagad");

// Load settings
db.ref("settings").once("value").then(snap=>{
  const data = snap.val()||{};
  adminBkash.value = data.bkashNumber||"";
  adminNagad.value = data.nagadNumber||"";
});

// Save Payment Numbers
function saveBkash(){
  db.ref("settings").update({bkashNumber:adminBkash.value});
  alert("Bkash Number saved!");
}
function saveNagad(){
  db.ref("settings").update({nagadNumber:adminNagad.value});
  alert("Nagad Number saved!");
}

// Render Products
function renderProducts(snapshot){
  productList.innerHTML="";
  snapshot.forEach(child=>{
    const p = child.val();
    const key = child.key;
    let tr=document.createElement("tr");
    tr.className="show";
    tr.innerHTML=`<td>${p.name}</td><td>${p.category}</td><td>$${p.price}</td><td>${p.description}</td>
    <td>${p.image?'<img src="'+p.image+'" width="50">':''}</td>
    <td><button class="delete" onclick="deleteProduct('${key}')">Delete</button></td>`;
    productList.appendChild(tr);
    setTimeout(()=>tr.classList.add("show"),100);
  });
}

// Render Orders
function renderOrders(snapshot){
  orderList.innerHTML="";
  snapshot.forEach(child=>{
    const o = child.val();
    const key = child.key;
    let tr=document.createElement("tr");
    tr.className="show";
    tr.innerHTML=`<td>${o.product}</td><td>${o.name}</td><td>${o.email}</td>
    <td>${o.phone}</td><td>${o.payment}</td><td>${o.sendNumber||''}</td>
    <td>${o.trnx||''}</td><td>${o.date}</td>
    <td>
      <button class="done" onclick="deleteOrder('${key}')">Done</button>
      <button class="print" onclick="printInvoice('${key}')">Print</button>
    </td>`;
    orderList.appendChild(tr);
    setTimeout(()=>tr.classList.add("show"),100);
  });
}

// Listen to Products & Orders
db.ref("products").on("value", renderProducts);
db.ref("orders").on("value", renderOrders);

// Product Form Submit
document.getElementById("productForm").addEventListener("submit",e=>{
  e.preventDefault();
  const file=document.getElementById("prodImage").files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=function(ev){
      addProduct(ev.target.result);
    }
    reader.readAsDataURL(file);
  } else { addProduct(""); }
});

function addProduct(imgData){
  const newP={
    name:document.getElementById("prodName").value,
    category:document.getElementById("prodCategory").value,
    price:document.getElementById("prodPrice").value,
    description:document.getElementById("prodDescription").value,
    image:imgData
  };
  db.ref("products").push(newP);
  document.getElementById("productForm").reset();
}

// Delete Product
function deleteProduct(key){ db.ref("products/"+key).remove(); }

// Delete Order
function deleteOrder(key){ db.ref("orders/"+key).remove(); }

// Print Invoice
function printInvoice(key){
  db.ref("orders/"+key).once("value").then(snap=>{
    const o = snap.val();
    let w=window.open('','_blank');
    w.document.write(`<h2>Cloud Mart Invoice</h2>
    <p>Date: ${o.date}</p>
    <p>Name: ${o.name}</p>
    <p>Email: ${o.email}</p>
    <p>Phone: ${o.phone}</p>
    <p>Product: ${o.product}</p>
    <p>Payment: ${o.payment}</p>
    <p>Send Number: ${o.sendNumber}</p>
    <p>Transaction ID: ${o.trnx}</p>
    <hr><p>Thank you for your purchase!</p>`);
    w.print();
  });
}
</script>
</body>
</html>
